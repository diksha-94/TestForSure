package edu.tests.TestForSure.datalayer;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;

import edu.tests.TestForSure.common.DBConnection;
import edu.tests.TestForSure.entity.ExamCategory;
import edu.tests.TestForSure.entity.ViewReportQuestions;
import edu.tests.TestForSure.response.GetCategoryResponse;
import edu.tests.TestForSure.sql.CreateTestQueries;
import edu.tests.TestForSure.sql.ViewReportQueries;

public class ViewReportDAO {

	public static ArrayList<ViewReportQuestions> getQuestionsDAO(int report_id, int test_id){
		System.out.println("Calling DAO");
		String query = ViewReportQueries.getQuestions(report_id, test_id);
		Connection conn = DBConnection.getDBConnection();
		ResultSet rs = null;
		ArrayList<ViewReportQuestions> response = new ArrayList<ViewReportQuestions>();
		
		ViewReportQuestions ques = null;
		try{
			Statement statement = conn.createStatement();
			rs = statement.executeQuery(query);
			if(rs.isBeforeFirst()){
				while(rs.next()){
					ques.setQuesId(quesId);
					ques.setCorrect(correct);
					ques.setTimeSpent(timeSpent);
					ques.setCorrectOption(correctOption);
					ques.setMarkedOption(markedOption);
					ques.setQuestionType(questionType);
					ques.setParagraphText(paragraphText);
					ques.setQuestionText(questionText);
					ques.setOptionA(optionA);
					ques.setOptionB(optionB);
					ques.setOptionC(optionD);
					ques.setOptionD(optionD);
					ques.setExplanation(explanation);
					response.add(ques);
				}
				response = new GetCategoryResponse(categoryList, true, "Number of categories fetched: "+categoryList.size());
			}
			else {
				response = new GetCategoryResponse(null, false, "No data found");
			}
		}
		catch(Exception e){
			System.out.println("Exception from DAO: "+e.getMessage());
		}finally {
			try {
				if (conn != null)
					conn.close();
			} catch (SQLException e) {
				e.printStackTrace();
				response.setStatus(false);
				response.setMessage(e.getMessage());
			}
		}
		
		return response;
	}
}
